
DESCRIPTION DU PROCESSUS D'IMPORTATION DES DONNÉES (au 25/07/2024)

Voici précisément comment l'application gère l'importation des données depuis les Google Sheets. Le processus se déroule principalement dans le fichier `src/lib/sheets.ts`.

Étape 1 : Récupération des Catégories (Master Sheet)
----------------------------------------------------
1.  **Appel de la fonction `getCategories`** : Tout commence par l'appel de la fonction `getCategories`. Cette fonction est chargée de récupérer la liste de toutes les pages/catégories du site (Home, Projects, Catalog, etc.).

2.  **Mise en Cache (`unstable_cache`)** : Pour des raisons de performance et pour éviter de surcharger l'API de Google Sheets, le résultat de cette fonction est mis en cache pendant 5 minutes. Cela signifie que l'application ne va pas réellement chercher les données sur Google Sheets à chaque chargement de page, mais seulement toutes les 5 minutes.

3.  **Fetch du CSV du Master Sheet** : La fonction utilise `fetch` pour télécharger le contenu du "Master Sheet" via son URL publique CSV :
    `.../pub?gid=177392102&single=true&output=csv`

4.  **Parsing du CSV** : Le texte CSV est ensuite "parsé" (transformé) en un tableau d'objets JavaScript. Chaque objet représente une ligne du Master Sheet, donc une catégorie. Par exemple : `{ Name: 'Projects', Slug: 'projects', 'Url Sheet': '...' }`.

Étape 2 : Correctif Temporaire des GIDs (Le "Pansement" Actuel)
-------------------------------------------------------------
C'est l'étape la plus cruciale qui a été mise en place pour contourner le problème des mauvais GIDs dans votre Master Sheet.

1.  **Définition d'une "Carte de Correction"** : Dans le code de `getCategories`, il y a un objet JavaScript (`gidCorrectionMap`) qui contient les GIDs corrects pour chaque catégorie dont le GID était erroné dans le Master Sheet.

    Exemple de la carte :
    ```javascript
    const gidCorrectionMap = {
      'Home': '177392102', // Reste le master sheet, car pas de feuille dédiée
      'Projects': '153094389',
      'Catalog': '581525493',
      'Tools': '990396131',
      // ... etc.
    };
    ```

2.  **Vérification et Remplacement "à la volée"** : Le code parcourt ensuite chaque catégorie qui vient d'être récupérée du Master Sheet.
    *   Pour chaque catégorie (ex: "Projects"), il regarde le `gid` présent dans sa propriété `'Url Sheet'`.
    *   Il compare ce `gid` avec le `gid` correct stocké dans la `gidCorrectionMap`.
    *   **Si les GIDs ne correspondent pas**, le code remplace dynamiquement l'URL de la feuille (`'Url Sheet'`) par une nouvelle URL construite avec le bon `gid`.

    **C'est grâce à cette étape que les pages "Projects", "Catalog", etc., chargent maintenant les bonnes données, même si le Master Sheet contient toujours les mauvais `gid`.**

Étape 3 : Récupération des Données Spécifiques à une Page
-----------------------------------------------------------
1.  **Navigation de l'utilisateur** : Lorsque vous accédez à une page (par exemple, en cliquant sur "Projects" dans le menu), l'application exécute le composant de page `src/app/[...slug]/page.tsx`.

2.  **Identification de la Catégorie** : Ce composant analyse l'URL (ex: `/projects`) pour identifier la catégorie demandée.

3.  **Appel de `getCategoryData`** : Une fois la catégorie identifiée (l'objet "Projects" avec son URL de feuille corrigée), la fonction `getCategoryData` est appelée.

4.  **Fetch des Données Finales** : `getCategoryData` prend en paramètre l'URL de la feuille de la catégorie (qui a été corrigée à l'étape 2) et effectue un `fetch` pour récupérer le CSV de la feuille de calcul spécifique (par exemple, la feuille "Projects").

5.  **Affichage** : Les données de cette feuille spécifique sont ensuite parsées et affichées sur la page.


**En résumé :** Le système est actuellement un processus en deux temps. Il charge d'abord une liste de catégories depuis le Master Sheet, applique immédiatement un correctif en mémoire pour réparer les URLs des feuilles de calcul, puis utilise ces URLs corrigées pour charger les données réelles de la page que vous visitez.
