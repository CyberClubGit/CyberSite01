
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // La collection des produits est lisible par tout le monde,
    // mais ne peut être modifiée que par les fonctions backend.
    match /products/{productId} {
      allow read: if true;
      allow write: if false; // Empêche les modifications côté client

      // La sous-collection des prix est également lisible publiquement.
      match /prices/{priceId} {
        allow read: if true;
        allow write: if false;
      }
    }

    // Autorise les utilisateurs à gérer leur propre document de profil
    match /users/{userId} {
      // Un utilisateur peut créer son propre document de profil.
      allow create: if request.auth != null && request.auth.uid == userId;
      
      // Un utilisateur connecté peut lire et mettre à jour son propre profil.
      allow read, update: if request.auth != null && request.auth.uid == userId;
    }

  }
}
